name: ğŸ§¹ ä»£ç æ ¼å¼åŒ–ç¤ºä¾‹

on:
  push:
    branches: [ main, develop ]
    paths:
      - '**/*.cs'
  pull_request:
    branches: [ main ]
    paths:
      - '**/*.cs'
  workflow_dispatch:
    inputs:
      forceFormat:
        description: 'å¼ºåˆ¶æ ¼å¼åŒ–æ‰€æœ‰æ–‡ä»¶'
        required: false
        default: false
        type: boolean

jobs:
  # ç¤ºä¾‹1: åŸºæœ¬ç”¨æ³• - æ ¼å¼åŒ–æŒ‡å®šç›®å½•
  basic-format:
    name: åŸºæœ¬æ ¼å¼åŒ–
    uses: ./.github/workflows/roslyn-lint.yml
    with:
      formatDirectories: "Assets,CodeUnfucker/Src"
      allowAutofix: false
      allowFailure: false
      verboseOutput: true

  # ç¤ºä¾‹2: é«˜çº§ç”¨æ³• - è‡ªå®šä¹‰æ’é™¤å’Œè‡ªåŠ¨ä¿®å¤
  advanced-format:
    name: é«˜çº§æ ¼å¼åŒ–
    uses: ./.github/workflows/roslyn-lint.yml
    with:
      formatDirectories: "Assets,CodeUnfucker/Src,Scripts"
      excludeFiles: "**/Generated/*,**/Temp.*,**/*.Designer.cs,**/AssemblyInfo.cs"
      allowAutofix: ${{ github.event_name == 'workflow_dispatch' && inputs.forceFormat == true }}
      allowFailure: false
      verboseOutput: true

  # ç¤ºä¾‹3: ä»…æ£€æŸ¥æ¨¡å¼ï¼ˆç”¨äº PRï¼‰
  check-only:
    name: ä»…æ£€æŸ¥æ ¼å¼
    if: github.event_name == 'pull_request'
    uses: ./.github/workflows/roslyn-lint.yml
    with:
      formatDirectories: "Assets"
      excludeFiles: "Assets/Plugins/**,Assets/ThirdParty/**"
      allowAutofix: false
      allowFailure: false
      verboseOutput: true

  # ç¤ºä¾‹4: å®½æ¾æ¨¡å¼ï¼ˆå…è®¸å¤±è´¥ï¼‰
  lenient-format:
    name: å®½æ¾æ ¼å¼åŒ–
    if: github.event_name == 'push' && github.ref != 'refs/heads/main'
    uses: ./.github/workflows/roslyn-lint.yml
    with:
      formatDirectories: "Assets,CodeUnfucker/Src"
      excludeFiles: "**/Legacy/**"
      allowAutofix: false
      allowFailure: true
      verboseOutput: false

  # ç¤ºä¾‹5: è‡ªåŠ¨ä¿®å¤æ¨¡å¼ï¼ˆä»…é™ä¸»åˆ†æ”¯ï¼‰
  auto-fix:
    name: è‡ªåŠ¨ä¿®å¤æ ¼å¼
    if: github.event_name == 'push' && github.ref == 'refs/heads/main'
    uses: ./.github/workflows/roslyn-lint.yml
    with:
      formatDirectories: "Assets,CodeUnfucker/Src"
      excludeFiles: "Assets/Plugins/**,**/Generated/**"
      allowAutofix: true
      allowFailure: false
      verboseOutput: true